image: java:8-jdk

stages:
  - build
  - package

cache:
  paths:
    - .gradle/wrapper
    - .gradle/caches

build:
  stage: build
  before_script:
    - apt update && apt install -y make
  script:
    - make installDist
  after_script:
    - cp -r build/install/signald .
  artifacts:
    paths:
      - signald
    expire_in: 1 week

deb:
  stage: package
  before_script:
    - apt update && apt install -y make
  script:
    - make deb
    - mv build/distributions/*.deb .
  only:
    - tags
  artifacts:
    paths:
      - "*.deb"
